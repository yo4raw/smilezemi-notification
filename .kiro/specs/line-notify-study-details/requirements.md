# Requirements Document

## Project Description (Input)
LINE通知内容の拡張：勉強時間、ミッション名、点数の追加

## Introduction

現在のスマイルゼミクローラーシステムは、各ユーザーの「ミッション完了数」のみをLINEに通知しています。本機能拡張では、保護者がより詳細な学習状況を把握できるよう、通知内容に「勉強時間」「ミッション名」「獲得点数」を追加します。これにより、子供の学習進捗を具体的に把握し、適切なサポートを提供できるようになります。

## Requirements

### Requirement 1: 勉強時間データの取得

**Objective:** 保護者として、各ユーザーの当日の勉強時間を把握したい。そうすることで、学習への取り組み状況を定量的に評価できる。

#### 受け入れ基準

1. When クローラーがみまもるネットにログインした後、the クローラーシステム shall 各ユーザーの当日の勉強時間を取得する
2. The クローラーシステム shall 勉強時間を「時間」と「分」の単位で正確に抽出する
3. If 勉強時間データが存在しない場合、then the クローラーシステム shall 0時間0分として扱う
4. The クローラーシステム shall 取得した勉強時間データを構造化された形式で保存する

### Requirement 2: ミッション詳細データの取得

**Objective:** 保護者として、各ユーザーが完了したミッションの詳細情報を知りたい。そうすることで、どの学習分野に取り組んでいるかを把握できる。

#### 受け入れ基準

1. When クローラーが当日のミッションページにアクセスした時、the クローラーシステム shall 完了済みミッションの一覧を取得する
2. The クローラーシステム shall 各完了ミッションについて、ミッション名と獲得点数を抽出する
3. If ミッション名が取得できない場合、then the クローラーシステム shall デフォルト名（例：「ミッション」）を使用する
4. The クローラーシステム shall 最大10件までのミッション詳細を取得する
5. When 完了ミッションが10件を超える場合、the クローラーシステム shall 最新の10件のみを取得する

### Requirement 3: 点数データの取得

**Objective:** 保護者として、各ミッションで獲得した点数を知りたい。そうすることで、学習の質と理解度を評価できる。

#### 受け入れ基準

1. When クローラーがミッション詳細を取得する時、the クローラーシステム shall 各ミッションの獲得点数を抽出する
2. The クローラーシステム shall 点数を数値形式（整数）で保存する
3. If 点数データが取得できない場合、then the クローラーシステム shall 点数を0点として扱う
4. The クローラーシステム shall 各ユーザーの当日の合計点数を計算する

### Requirement 4: LINE通知内容の拡張

**Objective:** 保護者として、LINEで詳細な学習状況を受け取りたい。そうすることで、スマートフォンから素早く学習進捗を確認できる。

#### 受け入れ基準

1. When クローラーがデータ取得を完了した時、the LINE通知システム shall 各ユーザーの詳細情報を含むメッセージを送信する
2. The LINE通知システム shall 通知メッセージに以下の情報を含める：ユーザー名、勉強時間（"H:MM"形式）、完了ミッション数、ミッション詳細（名前と点数）
3. The LINE通知システム shall ミッション詳細を読みやすいリスト形式で表示する（例：「・算数の問題: 85点」）
4. When 前回データが存在し点数が変化している場合、the LINE通知システム shall 点数変化を「前回点数→現在点数」形式で表示する（例：「・算数の問題: 80→95点」）
5. When 複数ユーザーが存在する場合、the LINE通知システム shall ユーザーごとに情報を分けて表示する
6. The LINE通知システム shall メッセージの文字数がLINE APIの上限を超えないよう制御する

### Requirement 5: データ保存と履歴管理

**Objective:** システム管理者として、取得したデータを保存して履歴管理したい。そうすることで、データの変更検出と分析が可能になる。

#### 受け入れ基準

1. When クローラーがデータ取得を完了した時、the クローラーシステム shall 詳細データをJSONファイルとして保存する
2. The クローラーシステム shall 前回実行時のデータと比較して変更を検出する
3. When 新しいミッションが完了している場合、the LINE通知システム shall 新規完了ミッションを強調表示する
4. The クローラーシステム shall データファイルに取得日時のタイムスタンプを含める
5. The クローラーシステム shall 過去7日分のデータファイルを保持する

### Requirement 6: エラーハンドリングとフォールバック

**Objective:** システム管理者として、データ取得エラー時にも適切に動作してほしい。そうすることで、システムの信頼性を確保できる。

#### 受け入れ基準

1. If 勉強時間の取得に失敗した場合、then the クローラーシステム shall エラーログを記録し、その項目のみをスキップして処理を継続する
2. If ミッション詳細の取得に失敗した場合、then the LINE通知システム shall ミッション数のみを通知する（従来の動作にフォールバック）
3. When 部分的なデータのみ取得できた場合、the LINE通知システム shall 取得できたデータのみを通知する
4. The クローラーシステム shall すべてのエラー情報をLINE通知に含める
5. If データ保存に失敗した場合、then the クローラーシステム shall エラーをLINE通知し、処理を継続する

### Requirement 7: パフォーマンスと制約

**Objective:** システム管理者として、システムが効率的に動作してほしい。そうすることで、GitHub Actionsの実行時間制限内で完了できる。

#### 受け入れ基準

1. The クローラーシステム shall ユーザーあたりのデータ取得を30秒以内に完了する
2. The クローラーシステム shall 全体の実行時間を5分以内に抑える
3. The LINE通知システム shall LINE API呼び出しを最小限に抑える（ユーザー数に関わらず最大3回まで）
4. The クローラーシステム shall 不要なページ遷移を避け、必要最小限のナビゲーションで情報を取得する
